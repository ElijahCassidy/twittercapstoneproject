import streamlit as st

st.markdown(
    """
    <style>
    /* This changes the main background of the app */
    .stApp {
        background-color: #E1F5FE;
    }
    </style>
    """,
    unsafe_allow_html=True
)

if 'users' not in st.session_state:
    st.session_state.users = {}
if 'posts' not in st.session_state:
    st.session_state.posts = []
if 'post_id' not in st.session_state:
    st.session_state.post_id = 1

st.title("Twitter Clone")

menu = ["Create User", "Make a Post", "View Feed", "Like a Post", "Edit Bio"]
cols = st.columns(len(menu))

if 'choice' not in st.session_state:
    st.session_state.choice = "View Feed"

for i, tab in enumerate(menu):
    if cols[i].button(tab):
        st.session_state.choice = tab

st.divider()

choice = st.session_state.choice

if choice == "Create User":
    st.subheader("Create a New Account")
    new_user = st.text_input("Enter a username")
    new_bio = st.text_area("Enter your bio")
    
    if st.button("Register"):
        if new_user and new_user not in st.session_state.users:
            st.session_state.users[new_user] = {'bio': new_bio, 'followers': 0}
            st.success(f"User '{new_user}' created!")
        else:
            st.error("Username already exists or is empty.")

elif choice == "Make a Post":
    st.subheader("Share something!")
    post_user = st.selectbox("Who are you?", list(st.session_state.users.keys()))
    content = st.text_area("What's on your mind?")
    
    if st.button("Post"):
        new_post = {
            "id": st.session_state.post_id,
            "user": post_user,
            "text": content,
            "likes": 0
        }
        st.session_state.posts.append(new_post)
        st.session_state.post_id += 1
        st.success("Post shared to the feed!")

elif choice == "View Feed":
    st.markdown("### **THE FEED**")
    
    if not st.session_state.posts:
        st.info("No posts yet.")
    else:
        for post in reversed(st.session_state.posts):
            with st.container():
                st.write(f"**@{post['user']}** (Post ID: {post['id']})")
                st.write(post['text'])
                st.caption(f"Likes: {post['likes']}")
                st.divider()

elif choice == "Like a Post":
    st.subheader("Like a Post")
    if not st.session_state.posts:
        st.warning("Nothing to like yet.")
    else:
        post_to_like = st.number_input("Enter Post ID to like", min_value=1, step=1)
        if st.button("Like"):
            found = False
            for p in st.session_state.posts:
                if p['id'] == post_to_like:
                    p['likes'] += 1
                    st.success(f"You liked post #{post_to_like}!")
                    found = True
                    break
            if not found:
                st.error("Post ID not found.")

elif choice == "Edit Bio":
    st.subheader("Update Your Profile")
    edit_user = st.selectbox("Select your username", list(st.session_state.users.keys()))
    if edit_user:
        new_bio = st.text_area("New Bio", value=st.session_state.users[edit_user]['bio'])
        if st.button("Update"):
            st.session_state.users[edit_user]['bio'] = new_bio
            st.success("Bio updated!")
