import streamlit as st

st.markdown(
    """
    <style>
    /* Importing modern fonts */
    @import url('https://fonts.googleapis.com/css2?family=Chivo+Mono:wght@700&family=Inter:wght@400;600&display=swap');

    header {visibility: hidden;}
    .stAppViewMain > div:nth-child(1) {padding-top: 0rem;}
    [data-testid="stDecoration"] {display: none;}

    .stApp {
        background-color: #64B5F6;
        /* Geometric Pattern Overlay */
        background-image:  radial-gradient(#ffffff33 1px, transparent 1px);
        background-size: 20px 20px;
        color: white;
        font-family: 'Inter', sans-serif;
    }

    /* Centered Title with Bitcount/Courier style Font */
    .main-title {
        font-family: 'Courier', monospace;
        font-size: 4rem;
        text-align: center;
        color: white;
        padding: 20px 0;
        letter-spacing: -2px;
        text-shadow: 3px 3px 0px #1565C0;
    }

    .stMarkdown, p, span, label, .stSubheader {
        color: white !important;
        font-family: 'Courier', sans-serif;
    }

    /* Main Menu Buttons */
    div.stButton > button {
        width: 100%;
        background-color: #1565C0 !important;
        color: white !important;
        border: 2px solid #0D47A1 !important;
        font-weight: bold;
        font-family: 'Inter', sans-serif;
        border-radius: 12px;
        transition: 0.2s ease-in-out;
    }
    
    div.stButton > button:hover {
        background-color: #0D47A1 !important;
        border-color: white !important;
        transform: scale(1.02);
    }

    /* Circle Like Buttons */
    div[data-testid="stVerticalBlock"] div.stButton > button[key^="like_"] {
        width: 50px !important;
        height: 50px !important;
        padding: 0px !important;
        border-radius: 50% !important;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px !important;
        margin: 0 auto;
    }

    /* Input Fields */
    .stTextInput>div>div>input, .stTextArea>div>div>textarea, .stSelectbox>div>div>div {
        background-color: rgba(255, 255, 255, 0.9) !important;
        color: #0D47A1 !important;
        font-family: 'Inter', sans-serif;
        border-radius: 10px !important;
    }

    /* Feed Container Styling */
    [data-testid="stVerticalBlock"] > div {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 10px;
    }
    </style>
    """,
    unsafe_allow_html=True
)

if 'users' not in st.session_state:
    st.session_state.users = {}
if 'posts' not in st.session_state:
    st.session_state.posts = []
if 'post_id' not in st.session_state:
    st.session_state.post_id = 1
if 'liked_posts' not in st.session_state:
    st.session_state.liked_posts = set()
if 'choice' not in st.session_state:
    st.session_state.choice = "View Feed"
if 'show_menu' not in st.session_state:
    st.session_state.show_menu = False

# Centered Title
st.markdown('<h1 class="main-title">JA</h1>', unsafe_allow_html=True)

if st.button(f"☰ {st.session_state.choice.upper()}", use_container_width=True):
    st.session_state.show_menu = not st.session_state.show_menu

if st.session_state.show_menu:
    menu_options = ["View Feed", "Make a Post", "Create User", "Edit Bio"]
    cols = st.columns(len(menu_options))
    for i, tab in enumerate(menu_options):
        if cols[i].button(tab, use_container_width=True):
            st.session_state.choice = tab
            st.session_state.show_menu = False
            st.rerun()

st.divider()

choice = st.session_state.choice

if choice == "Create User":
    st.subheader("Create a New Account")
    new_user = st.text_input("Enter a username")
    new_bio = st.text_area("Enter your bio")
    
    if st.button("Register", use_container_width=True):
        if new_user and new_user not in st.session_state.users:
            st.session_state.users[new_user] = {'bio': new_bio, 'followers': 0}
            st.success(f"User '{new_user}' created!")
        else:
            st.error("Username already exists or is empty.")

elif choice == "Make a Post":
    st.subheader("Share something!")
    if not st.session_state.users:
        st.warning("Please create a user first.")
    else:
        post_user = st.selectbox("Who are you?", list(st.session_state.users.keys()))
        content = st.text_area("What's on your mind?")
        
        if st.button("Post", use_container_width=True):
            new_post = {
                "id": st.session_state.post_id,
                "user": post_user,
                "text": content,
                "likes": 0
            }
            st.session_state.posts.append(new_post)
            st.session_state.post_id += 1
            st.success("Post shared to the feed!")

elif choice == "View Feed":
    st.markdown("### **Feed:**")
    
    if not st.session_state.posts:
        st.info("No posts yet.")
    else:
        for post in reversed(st.session_state.posts):
            with st.container():
                st.write(f"**@{post['user']}**")
                st.write(post['text'])
                
                is_liked = post['id'] in st.session_state.liked_posts
                
                col1, col2 = st.columns([1, 10])
                with col1:
                    if st.button(
                        f" ❤️ " if is_liked else "♡", 
                        key=f"like_{post['id']}", 
                        type="primary" if is_liked else "secondary"
                    ):
                        if not is_liked:
                            post['likes'] += 1
                            st.session_state.liked_posts.add(post['id'])
                        else:
                            post['likes'] -= 1
                            st.session_state.liked_posts.remove(post['id'])
                        st.rerun()
                with col2:
                    st.write(f"{post['likes']} likes")
                
                st.divider()

elif choice == "Edit Bio":
    st.subheader("Update Your Profile")
    if not st.session_state.users:
        st.warning("No users found.")
    else:
        edit_user = st.selectbox("Select your username", list(st.session_state.users.keys()))
        if edit_user:
            new_bio = st.text_area("New Bio", value=st.session_state.users[edit_user]['bio'])
            if st.button("Update", use_container_width=True):
                st.session_state.users[edit_user]['bio'] = new_bio
                st.success("Bio updated!")
